<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - Simple</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .share-section {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .input-section {
            background: #f8f9fa;
            border: 2px solid #007bff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .input-section h3 {
            color: #0056b3;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .input-group {
            margin: 20px 0;
            padding: 20px;
            background: #f1f3f4;
            border-radius: 10px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 18px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        .inventory-list {
            margin-top: 30px;
        }
        
        .inventory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin: 10px 0;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .inventory-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .item-info {
            flex-grow: 1;
        }
        
        .item-code {
            font-family: monospace;
            color: #666;
            font-size: 0.9em;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 5px;
        }
        
        .item-quantity {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
            margin: 0 20px;
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 10px;
        }
        
        .item-datetime {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
        
        .status {
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .export-section {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            text-align: center;
        }
        
        .share-link {
            background: white;
            border: 2px dashed #28a745;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
            word-break: break-all;
            color: #495057;
        }
        
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        
        .instructions h4 {
            color: #856404;
            margin-bottom: 15px;
        }
        
        .instructions ol {
            color: #856404;
        }
        
        .instructions li {
            margin: 8px 0;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .content {
                padding: 20px;
            }
            
            .inventory-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .item-quantity {
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
            <p>‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢ - ‡πÅ‡∏ä‡∏£‡πå URL ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô</p>
        </div>
        
        <div class="content">
            <!-- Share Section -->
            <div class="share-section">
                <h3>üîó ‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô</h3>
                <p>‡∏™‡πà‡∏á URL ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô:</p>
                <div class="share-link" id="shareLink">
                    https://tateam03-sketch.github.io/donjai/?store=demo-shop
                </div>
                <button class="btn btn-primary" onclick="copyShareLink()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Ñ‡πå</button>
                <button class="btn btn-success" onclick="generateNewStoreId()">üîÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
                
                <div class="instructions">
                    <h4>üí° ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡∏°:</h4>
                    <ol>
                        <li><strong>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô</strong> ‡πÇ‡∏î‡∏¢‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà"</li>
                        <li><strong>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Ñ‡πå</strong> ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</li>
                        <li><strong>‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô</strong> ‡∏ú‡πà‡∏≤‡∏ô Line, WhatsApp, ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏µ‡πÄ‡∏°‡∏•</li>
                        <li><strong>‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô</strong> = ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô</li>
                        <li><strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</strong> ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</li>
                    </ol>
                </div>
            </div>
            
            <!-- Input Section -->
            <div class="input-section">
                <h3>‚ö° ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                
                <div class="input-group">
                    <label for="productCode">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
                    <input type="text" id="productCode" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô 8850188210300" autofocus>
                </div>
                
                <div class="input-group">
                    <label for="productName">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
                    <input type="text" id="productName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="input-group" style="margin: 10px 0;">
                        <label for="quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</label>
                        <input type="number" id="quantity" min="1" value="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                    </div>
                    
                    <div class="input-group" style="margin: 10px 0;">
                        <label for="action">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥:</label>
                        <select id="action">
                            <option value="add">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</option>
                            <option value="set">‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏´‡∏°‡πà</option>
                            <option value="subtract">‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</option>
                        </select>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-success" onclick="addItem()" style="font-size: 18px; padding: 18px 40px;">
                        üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </button>
                    <button class="btn btn-primary" onclick="refreshData()" style="font-size: 18px; padding: 18px 40px;">
                        üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                </div>
            </div>
            
            <!-- Status Messages -->
            <div id="statusMessage"></div>
            
            <!-- Statistics -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalItems">0</div>
                    <div>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalQuantity">0</div>
                    <div>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="currentStore" style="font-size: 1.5em;">-</div>
                    <div>‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô</div>
                </div>
            </div>
            
            <!-- Inventory List -->
            <div class="inventory-list">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</h3>
                    <button class="btn btn-danger" onclick="clearAll()">üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
                <div id="inventoryItems">
                    <p style="text-align: center; color: #999; padding: 40px; font-size: 18px;">
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...<br>
                        <small>‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏•‡∏¢!</small>
                    </p>
                </div>
            </div>
            
            <!-- Export Section -->
            <div class="export-section">
                <h3>üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <button class="btn btn-primary" onclick="exportData()">üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>
                <button class="btn btn-primary" onclick="printData()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>
    </div>

    <script>
        let inventory = {};
        let currentStoreId = '';

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏û
        window.addEventListener('load', function() {
            initializeStore();
            setupKeyNavigation();
            startAutoRefresh();
        });

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡πâ‡∏≤‡∏ô
        function initializeStore() {
            // ‡∏≠‡πà‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏≤‡∏Å URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const storeParam = urlParams.get('store');
            
            if (storeParam) {
                currentStoreId = storeParam;
            } else {
                currentStoreId = 'demo-shop';
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï URL
                window.history.replaceState({}, '', '?store=' + currentStoreId);
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ä‡∏£‡πå
            updateShareLink();
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            loadInventoryFromStorage();
            updateDisplay();
            
            document.getElementById('currentStore').textContent = currentStoreId;
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏ä‡∏£‡πå
        function updateShareLink() {
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = baseUrl + '?store=' + currentStoreId;
            document.getElementById('shareLink').textContent = shareUrl;
        }

        // ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Ñ‡πå
        function copyShareLink() {
            const shareLink = document.getElementById('shareLink').textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareLink).then(() => {
                    showStatus('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß!', 'success');
                });
            } else {
                // Fallback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤
                const textArea = document.createElement('textarea');
                textArea.value = shareLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showStatus('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß!', 'success');
            }
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
        function generateNewStoreId() {
            const newId = 'shop_' + Date.now().toString(36) + '_' + Math.random().toString(36).substring(2, 8);
            currentStoreId = newId;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï URL
            window.history.replaceState({}, '', '?store=' + currentStoreId);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡∏¥‡∏á‡∏Ñ‡πå
            updateShareLink();
            
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
            inventory = {};
            updateDisplay();
            
            document.getElementById('currentStore').textContent = currentStoreId;
            showStatus('üéâ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß: ' + currentStoreId, 'success');
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏î Enter
        function setupKeyNavigation() {
            const productCode = document.getElementById('productCode');
            const productName = document.getElementById('productName');
            const quantity = document.getElementById('quantity');

            productCode.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    productName.focus();
                }
            });

            productName.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    quantity.focus();
                }
            });

            quantity.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addItem();
                }
            });
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏° Auto Refresh
        function startAutoRefresh() {
            setInterval(() => {
                refreshData(false); // ‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            }, 15000); // ‡∏ó‡∏∏‡∏Å 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
        function loadInventoryFromStorage() {
            const storageKey = 'shared_inventory_' + currentStoreId;
            const stored = localStorage.getItem(storageKey);
            if (stored) {
                try {
                    const data = JSON.parse(stored);
                    inventory = data.inventory || {};
                } catch (e) {
                    inventory = {};
                }
            } else {
                inventory = {};
            }
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function saveInventoryToStorage() {
            const now = new Date();
            const data = {
                storeId: currentStoreId,
                inventory: inventory,
                timestamp: now.toISOString(),
                lastUpdate: now.toLocaleString('th-TH', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                }),
                deviceId: generateDeviceId()
            };
            
            const storageKey = 'shared_inventory_' + currentStoreId;
            localStorage.setItem(storageKey, JSON.stringify(data));
            
            // ‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï
            localStorage.setItem('update_signal_' + currentStoreId, Date.now().toString());
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Device ID
        function generateDeviceId() {
            let deviceId = localStorage.getItem('device_id');
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('device_id', deviceId);
            }
            return deviceId;
        }

        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function refreshData(showMessage = true) {
            loadInventoryFromStorage();
            updateDisplay();
            if (showMessage) {
                showStatus('üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'info');
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function addItem() {
            const code = document.getElementById('productCode').value.trim();
            const name = document.getElementById('productName').value.trim() || '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤-' + code;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const action = document.getElementById('action').value;
            
            if (!code) {
                showStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'error');
                document.getElementById('productCode').focus();
                return;
            }
            
            const now = new Date();
            const currentDateTime = now.toLocaleString('th-TH', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            let newQuantity = quantity;
            let message = '';
            
            if (inventory[code]) {
                const currentQty = inventory[code].quantity;
                switch(action) {
                    case 'add':
                        newQuantity = currentQty + quantity;
                        message = `‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏° ${name}: ${currentQty} + ${quantity} = ${newQuantity}`;
                        break;
                    case 'subtract':
                        newQuantity = Math.max(0, currentQty - quantity);
                        message = `‚ûñ ‡∏•‡∏î ${name}: ${currentQty} - ${quantity} = ${newQuantity}`;
                        break;
                    case 'set':
                        newQuantity = quantity;
                        message = `üîÑ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ${name}: ${newQuantity}`;
                        break;
                }
                inventory[code].quantity = newQuantity;
                inventory[code].name = name;
                inventory[code].lastUpdated = currentDateTime;
            } else {
                inventory[code] = {
                    name: name,
                    quantity: quantity,
                    timestamp: currentDateTime,
                    lastUpdated: currentDateTime
                };
                message = `‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà: ${name} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${quantity}`;
            }
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            saveInventoryToStorage();
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
            showStatus(message + ' (‡πÅ‡∏ä‡∏£‡πå‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡πÅ‡∏•‡πâ‡∏ß)', 'success');
            
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('productCode').value = '';
            document.getElementById('productName').value = '';
            document.getElementById('quantity').value = '1';
            document.getElementById('action').value = 'add';
            
            // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™
            setTimeout(() => {
                document.getElementById('productCode').focus();
            }, 500);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            updateDisplay();
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        function updateDisplay() {
            const itemsContainer = document.getElementById('inventoryItems');
            const totalItemsEl = document.getElementById('totalItems');
            const totalQuantityEl = document.getElementById('totalQuantity');
            
            if (Object.keys(inventory).length === 0) {
                itemsContainer.innerHTML = '<p style="text-align: center; color: #999; padding: 40px; font-size: 18px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£<br><small>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏•‡∏¢!</small></p>';
                totalItemsEl.textContent = '0';
                totalQuantityEl.textContent = '0';
                return;
            }
            
            let html = '';
            let totalItems = 0;
            let totalQuantity = 0;
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            const sortedItems = Object.entries(inventory).sort((a, b) => {
                const timeA = new Date(a[1].lastUpdated || a[1].timestamp);
                const timeB = new Date(b[1].lastUpdated || b[1].timestamp);
                return timeB - timeA;
            });
            
            for (const [code, item] of sortedItems) {
                totalItems++;
                totalQuantity += item.quantity;
                
                html += `
                    <div class="inventory-item">
                        <div class="item-info">
                            <div style="font-size: 1.1em;"><strong>${item.name}</strong></div>
                            <div class="item-code">${code}</div>
                            <div class="item-datetime">
                                üìÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${item.timestamp}<br>
                                üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ${item.lastUpdated || item.timestamp}
                            </div>
                        </div>
                        <div class="item-quantity">${item.quantity}</div>
                        <button class="btn btn-danger" onclick="removeItem('${code}')" style="padding: 8px 15px; font-size: 12px;">‚ùå ‡∏•‡∏ö</button>
                    </div>
                `;
            }
            
            itemsContainer.innerHTML = html;
            totalItemsEl.textContent = totalItems;
            totalQuantityEl.textContent = totalQuantity;
        }

        // ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function removeItem(code) {
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${inventory[code].name}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                const itemName = inventory[code].name;
                delete inventory[code];
                saveInventoryToStorage();
                updateDisplay();
                showStatus(`üóëÔ∏è ‡∏•‡∏ö "${itemName}" ‡πÅ‡∏•‡πâ‡∏ß`, 'info');
            }
        }

        // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function clearAll() {
            const itemCount = Object.keys(inventory).length;
            if (itemCount === 0) {
                showStatus('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏•‡∏ö', 'info');
                return;
            }
            
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${itemCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏™‡πà‡∏á‡∏ú‡∏•‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô!`)) {
                inventory = {};
                saveInventoryToStorage();
                updateDisplay();
                showStatus(`üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${itemCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß`, 'success');
                document.getElementById('productCode').focus();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            setTimeout(() => {
                statusEl.innerHTML = '';
            }, 4000);
        }

        // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô CSV
        function exportData() {
            if (Object.keys(inventory).length === 0) {
                showStatus('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å', 'error');
                return;
            }
            
            let csv = '‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤,‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô,‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°,‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î\n';
            
            for (const [code, item] of Object.entries(inventory)) {
                csv += `"${code}","${item.name}","${item.quantity}","${item.timestamp}","${item.lastUpdated || item.timestamp}"\n`;
            }
            
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            const now = new Date();
            const fileName = `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤_${currentStoreId}_${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}-${now.getMinutes().toString().padStart(2,'0')}.csv`;
            
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showStatus(`üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå "${fileName}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
        }

        // ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
        function printData() {
            if (Object.keys(inventory).length === 0) {
                showStatus('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå', 'error');
                return;
            }
            
            const now = new Date();
            const printTime = now.toLocaleString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            let totalQuantity = 0;
            let tableRows = '';
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            const sortedItems = Object.entries(inventory).sort((a, b) => 
                a[1].name.localeCompare(b[1].name, 'th')
            );
            
            for (const [code, item] of sortedItems) {
                totalQuantity += item.quantity;
                tableRows += `
                    <tr>
                        <td>${code}</td>
                        <td>${item.name}</td>
                        <td style="text-align: center;">${item.quantity}</td>
                        <td>${item.timestamp}</td>
                        <td>${item.lastUpdated || item.timestamp}</td>
                    </tr>
                `;
            }
            
            const printContent = `
                <!DOCTYPE html>
                <html lang="th">
                <head>
                    <meta charset="UTF-8">
                    <title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ${currentStoreId}</title>
                    <style>
                        @page { margin: 20mm; }
                        body { 
                            font-family: 'Sarabun', Arial, sans-serif; 
                            font-size: 12px;
                            line-height: 1.4;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 2px solid #333;
                            padding-bottom: 15px;
                            margin-bottom: 20px;
                        }
                        .header h1 {
                            margin: 0;
                            font-size: 24px;
                            color: #333;
                        }
                        .header p {
                            margin: 5px 0;
                            color: #666;
                        }
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin-top: 15px;
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 8px; 
                            text-align: left; 
                            vertical-align: top;
                        }
                        th { 
                            background-color: #f8f9fa; 
                            font-weight: bold;
                            text-align: center;
                        }
                        tr:nth-child(even) {
                            background-color: #f9f9f9;
                        }
                        .summary {
                            margin-top: 20px;
                            padding: 15px;
                            background-color: #e9ecef;
                            border-radius: 5px;
                        }
                        .summary h3 {
                            margin: 0 0 10px 0;
                            color: #495057;
                        }
                        .footer {
                            margin-top: 30px;
                            text-align: center;
                            color: #666;
                            font-size: 10px;
                            border-top: 1px solid #ddd;
                            padding-top: 10px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
                        <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô:</strong> ${currentStoreId}</p>
                        <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå:</strong> ${printTime}</p>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th width="15%">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th width="30%">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th width="10%">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                <th width="20%">‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°</th>
                                <th width="25%">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>
                    
                    <div class="summary">
                        <h3>üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</h3>
                        <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${Object.keys(inventory).length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                        <p><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏ß‡∏°:</strong> ${totalQuantity} ‡∏ä‡∏¥‡πâ‡∏ô</p>
                        <p><strong>‡∏£‡∏´‡∏±‡∏™‡∏£‡πâ‡∏≤‡∏ô:</strong> ${currentStoreId}</p>
                    </div>
                    
                    <div class="footer">
                        <p>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ ${printTime}</p>
                    </div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            
            setTimeout(() => {
                printWindow.print();
                showStatus('üñ®Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }, 500);
        }

        // ‡∏ü‡∏±‡∏á storage events ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ã‡∏¥‡∏á‡∏Ñ‡πå
        window.addEventListener('storage', (e) => {
            if (e.key && e.key.startsWith('update_signal_' + currentStoreId)) {
                refreshData(false); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ
            }
        });
    </script>
</body>
</html>
